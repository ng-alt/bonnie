
all: bonnie++

SCRIPTS=bon_csv2html bon_csv2txt
EXES=bonnie++ zcav

CXX=@CXX@ -O2 -g -Wall -W -Wshadow -Wpointer-arith -Wcast-align -Wwrite-strings -DNDEBUG

BONSRC=bon_io.cpp bon_file.cpp bon_time.cpp semaphore.cpp forkit.cpp
BONOBJS=$(BONSRC:.cpp=.o)

ZCAVSRC=thread.cpp zcav_io.cpp
ZCAVOBJS=$(ZCAVSRC:.cpp=.o)

ALLOBJS=$(BONOBJS) $(ZCAVOBJS)

all: $(EXES)

bonnie++: bonnie++.cpp $(BONOBJS)
	$(CXX) bonnie++.cpp -o bonnie++ $(BONOBJS) $(LFLAGS)

zcav: zcav.cpp $(ZCAVOBJS)
	$(CXX) zcav.cpp -o zcav $(ZCAVOBJS) $(LFLAGS) -lpthread

install: $(EXES)
	mkdir -p $(DESTDIR)/usr/bin $(DESTDIR)/usr/sbin
	strip bonnie++ zcav
	cp $(SCRIPTS) $(DESTDIR)/usr/bin
	cp zcav bonnie++ $(DESTDIR)/usr/sbin

%.o: %.cpp %.h bonnie.h
	$(CXX) -c $<

clean:
	rm -f $(EXES) $(ALLOBJS) config.log
	rm -rf build-stamp install-stamp debian/tmp err out

realclean: clean
	rm -f config.* Makefile bonnie.h debian/postinst.debhelper
	rm -f debian/prerm.debhelper debian/substvars debian/files
